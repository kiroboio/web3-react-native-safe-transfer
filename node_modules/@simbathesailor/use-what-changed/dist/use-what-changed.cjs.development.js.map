{"version":3,"file":"use-what-changed.cjs.development.js","sources":["../src/useWhatChanged.tsx"],"sourcesContent":["import React from 'react';\n\ntype TypeDependency = any[];\ntype TypeDependencyNames = string;\n\nlet what_debug_changed = 0;\n\nlet configuration = { active: true };\nfunction setUseWhatChange({ active = true }: any = {}) {\n  configuration = { ...configuration, active };\n}\n\n/**\n * Taken random color logic from some stackoverflow answer\n */\nfunction getRandomColor() {\n  var letters = '0123456789ABCDEF';\n  var color = '#';\n  for (var i = 0; i < 6; i++) {\n    color += letters[Math.floor(Math.random() * 16)];\n  }\n  return color;\n}\n\n/**\n *\n * Check whether the dependency item is an object. then\n */\nconst isObject = (t: any) => {\n  return Object.prototype.toString.call(t) === '[object Object]';\n};\n\nfunction getPrintableInfo(dependencyItem: any) {\n  /**\n   * Printing the info into viewable format\n   */\n  if (isObject(dependencyItem) || Array.isArray(dependencyItem)) {\n    let ans;\n    try {\n      ans = JSON.stringify(dependencyItem, null, 2);\n    } catch (e) {\n      ans = 'CIRCULAR JSON';\n    }\n    return ans;\n  }\n\n  return dependencyItem;\n}\n\n// const isDevelopment = process.env['NODE_ENV'] === 'development';\n\nfunction useHotRefs(value: any) {\n  const fnRef = React.useRef(value);\n  React.useEffect(() => {\n    fnRef.current = value;\n  });\n\n  return fnRef;\n}\n\nfunction useWhatChanged(\n  dependency?: TypeDependency,\n  dependencyNames?: TypeDependencyNames,\n  suffix?: string,\n  hookName?: string\n) {\n  \n  // It's a fair assumption the hooks type will not change for a component during\n  // its life time\n  const hookNameFinal = React.useMemo(() => {\n\n   \n    if(hookName === \"useLayoutEffect\") {\n      return \"useLayoutEffect\"\n    }\n\n    // if(hookName === \"useEffect\" || !hookName) {\n      return \"useEffect\"\n    // }\n  }, [])\n  // This ref is responsible for book keeping of the old value\n  const dependencyRef = React.useRef(dependency);\n\n  // For count bookkeeping , for easy debugging\n  const whatChangedHookCountRef = React.useRef(1);\n\n  // For assigning color for easy debugging\n  const backgroundColorRef = React.useRef('');\n\n  let isDependencyArr = Array.isArray(dependencyRef.current);\n\n  React[hookNameFinal](() => {\n   \n      if (\n        dependencyRef.current &&\n        isDependencyArr\n        // dependencyRef.current.length > 0\n      ) {\n        what_debug_changed++;\n  \n        whatChangedHookCountRef.current = what_debug_changed;\n        backgroundColorRef.current = getRandomColor();\n      }\n   \n    // const MyWindow: IWindow = window;\n    \n  }, [dependencyRef, isDependencyArr]);\n\n  function postConsole() {\n    console.log('\\n');\n    console.log(\n      `%c///// END SECTION/////`,\n      `background: ${backgroundColorRef.current}; color: white; font-size: 10px`,\n      '\\n'\n    );\n    console.log('\\n');\n    console.log('\\n');\n  }\n  function logBanners({\n    isFirstMount,\n    suffixText,\n    isBlankArrayAsDependency,\n  }: {\n    isFirstMount?: boolean;\n    suffixText?: string;\n    isBlankArrayAsDependency?: boolean;\n  }) {\n    if (configuration.active) {\n      console.log(\n        `%c///// START SECTION /////`,\n        `background: ${backgroundColorRef.current}; color: white; font-size: 10px`,\n        '\\n'\n      );\n      console.log('\\n');\n      console.log(\n        `%c ${whatChangedHookCountRef.current} ${suffix || ''}`,\n        `background: ${backgroundColorRef.current}; color: white; font-size: 10px`,\n        '👇🏾',\n        `${isFirstMount ? 'FIRST RUN' : 'UPDATES'}`,\n        `${suffixText}`\n      );\n\n      if (isBlankArrayAsDependency) {\n        postConsole();\n      }\n    }\n  }\n\n  const longBannersRef = useHotRefs(logBanners);\n\n  React[hookNameFinal](() => {\n\n   \n      if (!(dependencyRef.current && isDependencyArr)) {\n        return;\n      }\n  \n      // if (dependencyRef.current.length === 0) {\n      //   return;\n      // }\n  \n      // More info, if needed by user\n      const stringSplitted = dependencyNames ? dependencyNames.split(',') : null;\n      let changed = false;\n      const whatChanged = dependency\n        ? dependency.reduce((acc, dep, index) => {\n            if (dependencyRef.current && dep !== dependencyRef.current[index]) {\n              const oldValue = dependencyRef.current[index];\n              dependencyRef.current[index] = dep;\n              if (dependencyNames && stringSplitted) {\n                changed = true;\n                acc[`\"✅\" ${stringSplitted[index]}`] = {\n                  'Old Value': getPrintableInfo(oldValue),\n                  'New Value': getPrintableInfo(dep),\n                };\n              } else {\n                acc[`\"✅\" ${index}`] = {\n                  'Old Value': getPrintableInfo(oldValue),\n                  'New Value': getPrintableInfo(dep),\n                };\n              }\n  \n              return acc;\n            }\n            if (dependencyNames && stringSplitted) {\n              acc[`\"⏺\" ${stringSplitted[index]}`] = {\n                'Old Value': getPrintableInfo(dep),\n                'New Value': getPrintableInfo(dep),\n              };\n            } else {\n              acc[`\"⏺\" ${index}`] = {\n                'Old Value': getPrintableInfo(dep),\n                'New Value': getPrintableInfo(dep),\n              };\n            }\n  \n            return acc;\n          }, {})\n        : {};\n      if (configuration.active) {\n        const isBlankArrayAsDependency =\n          whatChanged && Object.keys(whatChanged).length === 0 && isDependencyArr;\n        longBannersRef.current({\n          isFirstMount: !changed,\n          suffixText: isBlankArrayAsDependency\n            ? ` 👉🏽 This will run only once on mount.`\n            : ``,\n          isBlankArrayAsDependency,\n        });\n  \n        if (!isBlankArrayAsDependency) {\n          console.table(whatChanged);\n          postConsole();\n        }\n      }\n   \n   \n  }, [\n    ...(() => {\n      if (dependency && isDependencyArr) {\n        return dependency;\n      }\n      return [];\n    })(),\n    dependencyRef,\n    longBannersRef,\n    hookName\n  ]);\n}\n\nexport { useWhatChanged, setUseWhatChange };\n"],"names":["what_debug_changed","configuration","active","getRandomColor","letters","color","i","Math","floor","random","isObject","t","Object","prototype","toString","call","getPrintableInfo","dependencyItem","Array","isArray","ans","JSON","stringify","e","useHotRefs","value","fnRef","React","useRef","useEffect","current","useWhatChanged","dependency","dependencyNames","suffix","hookName","hookNameFinal","useMemo","dependencyRef","whatChangedHookCountRef","backgroundColorRef","isDependencyArr","postConsole","console","log","logBanners","isFirstMount","suffixText","isBlankArrayAsDependency","longBannersRef","stringSplitted","split","changed","whatChanged","reduce","acc","dep","index","oldValue","keys","length","table"],"mappings":"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"}
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.buildModuleTree = void 0;
const ts_morph_1 = require("ts-morph");
const fs_1 = __importDefault(require("fs"));
const init_1 = require("./processors/init");
/**
 * Generates a {@link ModuleTree} for the passed
 *
 * @param module - the module configuration for which the tree should get generated
 * @returns module name and {@link ModuleTree}
 * @example
 * ```ts
 * import { buildModuleTree } from 'fliegdoc';
 *
 * buildModuleTree({
 * 	tsconfig,
 * 	package,
 * 	mainFile
 * });
 * ```
 */
function buildModuleTree(module) {
    const moduleTree = [];
    const project = new ts_morph_1.Project({
        tsConfigFilePath: module.tsconfig
    });
    const { name: moduleName } = JSON.parse(fs_1.default.readFileSync(module.package).toString());
    const indexFile = project.getSourceFileOrThrow(module.mainFile);
    const exportedDeclarations = indexFile.getExportedDeclarations();
    for (const [name, declarations] of exportedDeclarations) {
        moduleTree.push({
            name: `${name}`,
            declarations: declarations.map(init_1.processNode)
        });
    }
    return [moduleName, moduleTree];
}
exports.buildModuleTree = buildModuleTree;
//# sourceMappingURL=buildModuleTree.js.map